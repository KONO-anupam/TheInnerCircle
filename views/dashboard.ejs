<%- include('partials/header', { title: 'Dashboard' }) %>

<div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 border-b pb-4">
  <div>
    <h1 class="text-2xl font-bold mb-1">Community Feed</h1>
    <p class="text-gray-500">Latest posts from our members.</p>
  </div>
  <% if (user.is_member) { %>
    <a href="/create-message" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition">
      <i class="fas fa-plus-circle"></i> New Post
    </a>
  <% } else { %>
    <a href="/become-member" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition">
      <i class="fas fa-star"></i> Become a Member
    </a>
  <% } %>
</div>

<% if (!user.is_member) { %>
<div class="flex items-start bg-blue-100 text-blue-800 border border-blue-300 rounded-lg p-4 mb-6">
  <i class="fas fa-info-circle fa-2x mr-4"></i>
  <div>
    <h5 class="font-bold text-lg mb-1">Limited Access</h5>
    <p>
      As a non-member, you can only see that messages exist.
      <a href="/become-member" class="text-blue-700 underline">Become a member</a> to view
      posts, authors, and dates.
    </p>
  </div>
</div>
<% } %>

<div class="flex justify-center">
  <div class="w-full max-w-3xl">
    <% if (typeof messages !== 'undefined' && messages.length > 0) { %>
      <% messages.forEach(message => { %>
        <div class="bg-white shadow-md rounded-md mb-6 transition-all transform hover:-translate-y-1 hover:shadow-lg p-6">
          <h3 class="text-lg font-semibold mb-2"><%= message.title %></h3>
          <% if (user.is_member) { %>
            <p class="text-gray-800 mb-4"><%= message.text %></p>
            <div class="border-t pt-3 text-sm text-gray-500">
              <p>
                By <%= message.user.first_name %> <%= message.user.last_name %>
              </p>
              <p><%= new Date(message.timestamp).toLocaleString() %></p>
            </div>
          <% } else { %>
            <p class="italic text-gray-400">[Content hidden for non-members]</p>
          <% } %>

          <% if (user && user.is_admin) { %>
            <form action="/delete-message/<%= message._id %>" method="post" class="mt-4">
              <button type="submit" class="px-3 py-1 text-sm border border-red-600 text-red-600 hover:bg-red-600 hover:text-white rounded-md transition">
                <i class="fas fa-trash-alt mr-1"></i> Delete
              </button>
            </form>
          <% } %>
        </div>
      <% }) %>
    <% } else { %>
      <div class="flex flex-col items-center justify-center min-h-[300px] border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 text-center p-6">
        <i class="fas fa-comments text-5xl text-gray-300 mb-4"></i>
        <h4 class="text-gray-500 text-lg font-semibold mb-1">No Messages Yet</h4>
        <p class="text-gray-400 mb-3">Be the first to post and start a conversation!</p>
        <% if (user.is_member) { %>
          <a href="/create-message" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
            Create a Post
          </a>
        <% } %>
      </div>
    <% } %>
  </div>
</div>

<%- include('partials/footer') %>
