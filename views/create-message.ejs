<%- include('partials/header', { title: 'Create Message - Members Only' }) %>

<div class="flex justify-center px-4 mt-10">
  <div class="w-full max-w-4xl">
    <div class="bg-white shadow-lg rounded-lg p-8">
      <div class="text-center mb-6">
        <i class="fas fa-pen-fancy text-4xl text-blue-500 mb-4"></i>
        <h2 class="text-3xl font-bold text-gray-800">Create New Message</h2>
        <p class="text-gray-500">Share your thoughts with fellow members</p>
      </div>

      <% if (typeof error !== 'undefined' && error) { %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md flex items-center gap-2 mb-4" role="alert">
          <i class="fas fa-exclamation-triangle text-red-500"></i>
          <span><%= error %></span>
        </div>
      <% } %>

      <% if (typeof success !== 'undefined' && success) { %>
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-md mb-4">
          <i class="fas fa-check-circle mr-2"></i><%= success %>
          <div class="mt-2">
            <a href="/messages" class="text-green-700 hover:underline">
              <i class="fas fa-eye mr-1"></i>View All Messages
            </a>
          </div>
        </div>
      <% } %>

      <form action="/message" method="post">
        <div class="mb-6">
          <label for="title" class="block text-gray-700 font-medium mb-2">
            <i class="fas fa-heading mr-1"></i>Message Title
          </label>
          <input name="title" id="title" type="text" required maxlength="100"
            placeholder="Enter an engaging title for your message"
            value="<%= typeof formData !== 'undefined' && formData.title ? formData.title : '' %>"
            class="w-full border border-gray-300 rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400" />
          <p class="text-sm text-gray-500 mt-1">Make it catchy! This will be the first thing members see.</p>
        </div>

        <div class="mb-6">
          <label for="content" class="block text-gray-700 font-medium mb-2">
            <i class="fas fa-align-left mr-1"></i>Message Content
          </label>
          <textarea name="content" id="content" required maxlength="2000" rows="8"
            class="w-full border border-gray-300 rounded-md px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-400"
            placeholder="Share your thoughts, ideas, or start a discussion...">
<%= typeof formData !== 'undefined' && formData.content ? formData.content : '' %></textarea>
          <div class="flex justify-between text-sm text-gray-500 mt-1">
            <span>Express yourself! What's on your mind?</span>
            <span id="charCount">0 / 2000</span>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div class="bg-gray-100 rounded-md p-4">
            <h6 class="font-semibold text-gray-700 mb-2">
              <i class="fas fa-info-circle text-blue-400 mr-1"></i>Posting as:
            </h6>
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center">
                <i class="fas fa-user"></i>
              </div>
              <div>
                <div class="font-medium text-gray-800"><%= user.first_name %> <%= user.last_name %></div>
                <small class="text-gray-500">@<%= user.username %></small>
                <% if (user.is_member) { %>
                  <span class="ml-2 bg-yellow-400 text-black text-xs px-2 py-0.5 rounded-full">
                    <i class="fas fa-star"></i> Member
                  </span>
                <% } %>
              </div>
            </div>
          </div>

          <div class="bg-gray-100 rounded-md p-4">
            <h6 class="font-semibold text-gray-700 mb-2">
              <i class="fas fa-users text-green-500 mr-1"></i>Who can see this:
            </h6>
            <p class="text-sm text-gray-600">
              <i class="fas fa-check text-green-500 mr-1"></i>All registered users<br />
              <% if (user.is_member) { %>
                <i class="fas fa-star text-yellow-500 mr-1"></i>Members will see your member status
              <% } %>
            </p>
          </div>
        </div>

        <div class="flex justify-between gap-4">
          <a href="/messages" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium px-6 py-3 rounded-md flex items-center gap-2">
            <i class="fas fa-arrow-left"></i> Back to Messages
          </a>
          <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-medium px-6 py-3 rounded-md flex items-center gap-2">
            <i class="fas fa-paper-plane"></i> Post Message
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="mt-10 px-4">
  <div class="bg-gray-100 rounded-lg shadow-sm p-6">
    <h5 class="text-xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
      <i class="fas fa-lightbulb text-yellow-400"></i> Tips for Great Messages
    </h5>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="text-center">
        <i class="fas fa-heart text-3xl text-red-500 mb-3"></i>
        <h6 class="text-lg font-medium text-gray-800">Be Respectful</h6>
        <p class="text-sm text-gray-500">Treat fellow members with kindness and respect</p>
      </div>
      <div class="text-center">
        <i class="fas fa-comment-dots text-3xl text-blue-500 mb-3"></i>
        <h6 class="text-lg font-medium text-gray-800">Start Discussions</h6>
        <p class="text-sm text-gray-500">Ask questions or share interesting topics</p>
      </div>
      <div class="text-center">
        <i class="fas fa-share-alt text-3xl text-green-500 mb-3"></i>
        <h6 class="text-lg font-medium text-gray-800">Share Knowledge</h6>
        <p class="text-sm text-gray-500">Help others learn something new</p>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const contentTextarea = document.getElementById("content");
    const charCount = document.getElementById("charCount");

    function updateCharCount() {
      const currentLength = contentTextarea.value.length;
      charCount.textContent = `${currentLength} / 2000`;
      charCount.classList.remove("text-muted", "text-warning", "text-red-600");
      if (currentLength > 1950) {
        charCount.classList.add("text-red-600");
      } else if (currentLength > 1800) {
        charCount.classList.add("text-yellow-500");
      } else {
        charCount.classList.add("text-gray-500");
      }
    }

    contentTextarea.addEventListener("input", updateCharCount);
    updateCharCount();

    contentTextarea.addEventListener("input", function () {
      this.style.height = "auto";
      this.style.height = this.scrollHeight + "px";
    });
  });
</script>

<%- include('partials/footer') %>
